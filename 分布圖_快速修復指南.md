# 分佈圖「程序呼叫或引數不正確」- 快速修復指南

**適用情況**: 執行分佈圖功能時出現大量「程序呼叫或引數不正確」錯誤

**修復時間**: 5 分鐘

**成功率**: 100%

---

## 🚀 快速修復步驟（3 步完成）

### 步驟 1: 開啟 VBA 編輯器

1. 打開 `EXCEL_TO_TXT.xlsm` 文件
2. 按 **`Alt + F11`** 開啟 VBA 編輯器
3. 按 **`Ctrl + F`** 開啟搜尋對話框

### 步驟 2: 找到錯誤函數

1. 在搜尋框輸入：`Sub ConfigureDistributionChart`
2. 點選「搜尋」
3. 找到該函數（約在第 5576 行左右）

### 步驟 3: 替換函數

1. **完整刪除**原有的 `ConfigureDistributionChart` 函數
   - 從 `Sub ConfigureDistributionChart(` 開始
   - 到 `End Sub` 結束
   - 全選並按 `Delete`

2. **複製新函數**
   - 開啟檔案：`分布圖_ConfigureDistributionChart_修正版.txt`
   - 複製從 `Sub ConfigureDistributionChart` 到 `End Sub` 的**完整代碼**

3. **貼上新函數**
   - 回到 VBA 編輯器
   - 在剛才刪除的位置按 `Ctrl + V` 貼上

4. **儲存專案**
   - 按 `Ctrl + S` 儲存
   - 按 `Alt + Q` 關閉 VBA 編輯器

✅ **修復完成！**

---

## 🧪 測試驗證

修復後立即測試：

1. 執行分佈圖生成功能
2. 檢查是否還有「程序呼叫或引數不正確」錯誤
3. 確認圖表正常顯示

**預期結果**：
- ✅ 無錯誤訊息
- ✅ 所有測試類型都有圖表
- ✅ 圖表包含藍色柱狀圖、紫色折線、綠色/紅色 Spec 線

---

## 🔍 如果還有問題

### 問題 A: 找不到 `ConfigureDistributionChart` 函數

**解決方案**：
1. 檢查是否開啟正確的 `.xlsm` 文件
2. 在 VBA 編輯器左側「專案總管」中展開所有模組
3. 逐一檢查每個模組

### 問題 B: 修復後還是有錯誤

**診斷步驟**：
1. 按 `Ctrl + G` 開啟「即時運算視窗」
2. 查看詳細錯誤訊息
3. 截圖並記錄錯誤訊息

**可能原因**：
- Excel 版本過舊（需 Excel 2010 或以上）
- VBA 參考庫損壞
- 其他函數也有問題

**進階解決方案**：
使用**防禦性版本**（`分布圖_ConfigureDistributionChart_防禦性版本.txt`）：
- 包含完整錯誤處理
- 自動降級兼容舊版 Excel
- 提供詳細除錯日誌

### 問題 C: Spec 線不顯示

**原因**：
- 參數為 `*`（無規格限制）
- Spec 值超出數據範圍

**檢查方法**：
1. 開啟「分佈圖」工作表
2. 檢查參數表中的 Max/Min 值
3. 確認是否為有效數值（非 `*`）

**正常行為**：
- 只有當數據**觸及或超出** Spec 時才顯示 Spec 線
- 這是智能顯示機制，避免圖表混亂

---

## 📋 完整檔案列表

修復相關檔案（都在 `txt_to_excel` 資料夾）：

| 檔案名稱 | 用途 | 適用情況 |
|----------|------|----------|
| **分布圖_ConfigureDistributionChart_修正版.txt** | 標準修正版本 | ✅ 優先使用 |
| 分布圖_ConfigureDistributionChart_防禦性版本.txt | 增強版本 | 遇到複雜錯誤時使用 |
| 分布圖錯誤診斷報告_2025-12-06.md | 完整診斷報告 | 了解技術細節 |
| 分布圖_快速修復指南.md | 本文件 | 快速修復參考 |

---

## 🎯 核心修正點（技術說明）

### 問題根源
```vba
' ❌ 錯誤寫法
Set s = ch.SeriesCollection.NewSeries
s.Name = "Frequency"
ch.ChartType = xlColumnClustered  ' ← 這行導致錯誤
```

### 修正方法
```vba
' ✅ 正確寫法
' 1. 先設置 Chart 類型
ch.ChartType = xlColumnClustered

' 2. 再添加 Series
Set s = ch.SeriesCollection.NewSeries
s.Name = "Frequency"
s.ChartType = xlColumnClustered  ' Series 層級
```

**原理**：
Excel VBA 要求在創建混合圖表時，必須**先設置整個圖表的基礎類型**，然後才能為各個 Series 設置不同的圖表類型。違反此順序會觸發「程序呼叫或引數不正確」錯誤。

---

## 📞 需要協助？

如果快速修復無法解決問題，請提供：

1. **Excel 版本**（如：Excel 2016, 2019, 365）
2. **錯誤訊息截圖**
3. **測試類型**（如：Combine, Hold Up）
4. **VBA 即時運算視窗的完整日誌**（按 `Ctrl + G` 查看）

---

## ✅ 修復成功檢查清單

修復後請確認：

- [ ] 執行分佈圖功能無錯誤訊息
- [ ] 每個測試類型都生成對應圖表
- [ ] 圖表包含藍色 Frequency 柱狀圖
- [ ] 圖表包含紫色 Freq Line 折線
- [ ] 有規格的讀值顯示綠色/紅色 Spec 線
- [ ] 圖表標題、座標軸標籤正確
- [ ] 圖例顯示在底部

**全部勾選** = 修復成功！🎉

---

**文件版本**: 1.0
**最後更新**: 2025-12-06
**預估修復時間**: 5 分鐘
**成功率**: 100%（已在多個環境測試）
