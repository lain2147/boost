# åˆ†å¸ƒåœ–åŠŸèƒ½ - å®Œæ•´è™•ç†æµç¨‹æ‘˜è¦

**ç‰ˆæœ¬**ï¼šv2.0 (å¾ Excel è®€å–ç‰ˆæœ¬)
**æ—¥æœŸ**ï¼š2025-12-08
**æª”æ¡ˆ**ï¼š`DistributionChart_FromExcel_Complete.txt`

---

## ğŸ”„ å®Œæ•´è™•ç†æµç¨‹ï¼ˆæŒ‰é †åºåŸ·è¡Œï¼Œé †åºéŒ¯èª¤åœ–è¡¨å¯èƒ½å‡ºä¸ä¾†ï¼‰

### æ­¥é©Ÿ 1ï¼šé¸æ“‡ä¸¦é–‹å•Ÿ Excel æª”æ¡ˆ

```vba
' ä½¿ç”¨è€…é¸æ“‡å·²ç”Ÿæˆçš„æ¸¬è©¦å ±å‘Š Excel æª”æ¡ˆ
filePath = Application.GetOpenFilename("Excel Files (*.xlsx;*.xlsm), *.xlsx;*.xlsm")
Set wb = Workbooks.Open(filePath)
Set sourceWs = wb.Worksheets(1)  ' åŸå§‹æ¸¬è©¦å ±å‘Šå·¥ä½œè¡¨
```

---

### æ­¥é©Ÿ 2ï¼šå»ºç«‹æˆ–æ¸…ç©ºã€ŒDistribution Chartsã€å·¥ä½œè¡¨

```vba
' å»ºç«‹æ–°å·¥ä½œè¡¨
Set chartWs = wb.Worksheets.Add
chartWs.Name = "Distribution Charts"

' æ¸…ç©ºå…§å®¹ï¼ˆå¦‚æœæ˜¯æ›´æ–°ï¼‰
chartWs.Cells.Clear
On Error Resume Next
chartWs.ChartObjects.Delete  ' å®‰å…¨åˆªé™¤åœ–è¡¨ç‰©ä»¶
On Error GoTo 0
```

---

### æ­¥é©Ÿ 3ï¼šæƒææ‰€æœ‰ SEQ å€åŸŸ

```vba
Function ScanAllSEQFromSheet(ws As Worksheet) As Collection
    ' éæ­·æ‰€æœ‰è¡Œï¼Œè­˜åˆ¥ SEQ æ¨™é¡Œ
    ' ç¯„ä¾‹ï¼šSEQ.2: Load Regulation Test

    For row = 1 To lastRow
        If InStr(cellValue, "SEQ.") > 0 And InStr(cellValue, ":") > 0 Then
            ' è¨˜éŒ„ SEQ è³‡è¨Š
            seqInfo("number") = seqNumber      ' SEQ.2
            seqInfo("name") = testName         ' Load Regulation Test
            seqInfo("startRow") = row          ' èµ·å§‹è¡Œ
            seqInfo("endRow") = nextSeqRow - 1 ' çµæŸè¡Œ

            seqList.Add seqInfo
        End If
    Next row

    Set ScanAllSEQFromSheet = seqList
End Function
```

**è¼¸å‡ºç¯„ä¾‹**ï¼š
- SEQ.2: Load Regulation Test (è¡Œ 5-50)
- SEQ.3: Input/Output Test (è¡Œ 52-80)
- SEQ.4: Turn On Test (è¡Œ 82-95)

---

### æ­¥é©Ÿ 4ï¼šå°æ¯å€‹ SEQ é€²è¡Œè™•ç†ï¼ˆæ°´å¹³æ’åˆ—ï¼‰

```vba
' ä¸åŒ SEQ æ°´å¹³æ’åˆ—ï¼ˆå¹³è¡Œæ–°å¢ï¼‰
currentCol = 1  ' èµ·å§‹æ¬„ä½ (A æ¬„)

For Each seqInfo In seqList
    ' 4.1 æå–è©² SEQ çš„åƒæ•¸
    Set params = ExtractSEQParameters(sourceWs, seqInfo)

    ' 4.2 è­˜åˆ¥è©² SEQ çš„æ‰€æœ‰è®€å€¼æ¬„ä½
    Set readingsList = IdentifyReadingColumns(sourceWs, seqInfo)

    ' 4.3 è™•ç†è©² SEQ çš„æ¯å€‹è®€å€¼ï¼ˆå‚ç›´æ’åˆ—ï¼‰
    currentRow = 1
    isFirstReading = True

    For Each readingInfo In readingsList
        ' å¦‚æœæ˜¯ç¬¬ä¸€å€‹è®€å€¼ï¼Œå…ˆå¯«å…¥ SEQ æ¨™é¡Œ
        If isFirstReading Then
            Call WriteSeqTitle(chartWs, seqInfo, currentRow, currentCol)
            currentRow = currentRow + 2  ' æ¨™é¡Œå¾Œç©ºä¸€è¡Œ
            isFirstReading = False
        End If

        ' 4.4 ç‚ºè©²è®€å€¼å‰µå»ºåˆ†å¸ƒåœ–å€å¡Š
        Call CreateOneDistributionBlock(sourceWs, chartWs, seqInfo, readingInfo, params, currentRow, currentCol)

        ' ä¸‹ä¸€å€‹è®€å€¼å¾€ä¸‹ç§»å‹•
        currentRow = currentRow + 20  ' é ç•™ç©ºé–“
    Next readingInfo

    ' ä¸‹ä¸€å€‹ SEQ å¾€å³ç§»å‹•ï¼ˆå¹³è¡Œæ–°å¢ï¼‰
    currentCol = currentCol + 28 + 2  ' æ¯å€‹ SEQ å€å¡Š 28 æ¬„ + é–“éš” 2 æ¬„
Next seqInfo
```

**é‡è¦åŸå‰‡**ï¼š
- âœ… **åŒä¸€å€‹ SEQ çš„è®€å€¼**ï¼šå‚ç›´æ’åˆ—ï¼ˆå¾€ä¸‹ï¼‰
- âœ… **ä¸åŒ SEQ**ï¼šæ°´å¹³æ’åˆ—ï¼ˆå¾€å³ï¼‰
- âœ… **æ¯å€‹ SEQ åªé¡¯ç¤ºè©² SEQ çš„è®€å€¼**ï¼šä¸æœƒæ··é›œå…¶ä»– SEQ çš„æ•¸æ“š

---

### æ­¥é©Ÿ 4.1ï¼šæå– SEQ åƒæ•¸ï¼ˆå¾ Excelï¼‰

```vba
Function ExtractSEQParameters(ws As Worksheet, seqInfo As Object) As Object
    ' åœ¨ SEQ å€åŸŸå…§å°‹æ‰¾ Condition/Value è¡¨æ ¼
    ' ç¯„ä¾‹ï¼š
    ' | Condition | Value |
    ' | Vin       | 24    |
    ' | VdcMax    | 5.5   |
    ' | VdcMin    | 5.2   |

    Dim params As Object
    Set params = CreateObject("Scripting.Dictionary")

    For row = seqInfo("startRow") To seqInfo("endRow")
        If ws.Cells(row, condCol).Value = "Condition" Then
            ' æ‰¾åˆ°åƒæ•¸è¡¨ï¼Œé–‹å§‹æå–
            For i = row + 1 To seqInfo("endRow")
                paramName = ws.Cells(i, condCol).Value
                paramValue = ws.Cells(i, condCol + 1).Value

                If paramName <> "" And paramValue <> "" Then
                    params(paramName) = paramValue
                End If
            Next i
        End If
    Next row

    Set ExtractSEQParameters = params
End Function
```

**è¼¸å‡ºç¯„ä¾‹**ï¼š
```
params("Vin") = 24
params("Fin") = 0
params("VdcMax") = 5.5
params("VdcMin") = 5.2
params("VppMax") = 0.05
```

---

### æ­¥é©Ÿ 4.2ï¼šè­˜åˆ¥è®€å€¼æ¬„ä½

```vba
Function IdentifyReadingColumns(ws As Worksheet, seqInfo As Object) As Collection
    ' åœ¨ SEQ å€åŸŸå…§å°‹æ‰¾è®€å€¼æ¬„ä½ï¼ˆé€šå¸¸åœ¨ S/N è¡Œï¼‰
    ' ç¯„ä¾‹ï¼šS/N | VdcRead1 | VppRead1 | VdcRead2 | ...

    Dim readingsList As New Collection

    For col = 1 To lastCol
        headerValue = ws.Cells(snRow, col).Value

        If IsReadingColumn(headerValue) Then  ' æ’é™¤ S/N, Maximum, Minimum
            Set readingInfo = CreateObject("Scripting.Dictionary")
            readingInfo("name") = headerValue      ' "5.3_VdcRead1"
            readingInfo("colIndex") = col          ' æ¬„ä½ç´¢å¼•

            readingsList.Add readingInfo
        End If
    Next col

    Set IdentifyReadingColumns = readingsList
End Function
```

**è¼¸å‡ºç¯„ä¾‹**ï¼ˆLoad Regulation Testï¼‰ï¼š
- VdcRead1 (æ¬„ B)
- VppRead1 (æ¬„ C)
- VdcRead2 (æ¬„ D)
- VppRead2 (æ¬„ E)
- VdcRead3 (æ¬„ F)

---

### æ­¥é©Ÿ 4.3ï¼šç‚ºæ¯å€‹è®€å€¼å‰µå»ºåˆ†å¸ƒåœ–å€å¡Š

```vba
Sub CreateOneDistributionBlock(sourceWs, chartWs, seqInfo, readingInfo, params, startRow, startCol)
    ' ========== é †åº 1ï¼šæå–è®€å€¼æ•¸æ“š ==========
    Dim readingData As Collection
    Set readingData = ExtractReadingData(sourceWs, seqInfo, readingInfo("colIndex"))
    ' è¼¸å‡ºï¼šCollection of values (ä¾‹å¦‚ï¼š5.28, 5.29, 5.30, ...)

    If readingData.Count = 0 Then Exit Sub  ' æ²’æœ‰æ•¸æ“šå‰‡è·³é

    ' ========== é †åº 2ï¼šè¨ˆç®—é »ç‡ + åŠ å…¥ Spec æ¨™è¨˜ ==========
    Dim freqData As Collection
    Set freqData = CalculateFrequencyWithSpec(readingData, params, readingInfo("name"))
    ' è¼¸å‡ºï¼šCollection of sorted data with Spec markers
    ' ç¯„ä¾‹ï¼š
    ' [0] = ("4.55", 1, "", RGB(0,0,0))
    ' [1] = ("5.2_Min", Empty, "min", RGB(0,176,80))
    ' [2] = ("5.28", 3, "", RGB(0,0,0))
    ' [3] = ("5.5_MAX", Empty, "max", RGB(255,0,0))

    ' ========== é †åº 3ï¼šå¯«å…¥åƒæ•¸è¡¨ï¼ˆ2 æ¬„ï¼‰==========
    Call WriteParameterTable(chartWs, params, readingInfo("name"), startRow, startCol)
    ' å¯«å…¥ä½ç½®ï¼šstartCol ~ startCol+1 (ä¾‹å¦‚ï¼šA-B æ¬„)

    ' ========== é †åº 4ï¼šå¯«å…¥æ•¸æ“šè¡¨ï¼ˆ2 æ¬„ï¼‰==========
    Call WriteDataTable(chartWs, freqData, readingInfo("name"), startRow, startCol + 2)
    ' å¯«å…¥ä½ç½®ï¼šstartCol+2 ~ startCol+3 (ä¾‹å¦‚ï¼šC-D æ¬„)

    ' ========== é †åº 5ï¼šå‰µå»ºåœ–è¡¨ ==========
    Call CreateDistributionChart(chartWs, freqData, readingInfo("name"), startRow, startCol + 4)
    ' åœ–è¡¨ä½ç½®ï¼šstartCol+4 é–‹å§‹ (ä¾‹å¦‚ï¼šE æ¬„å¾€å³)
End Sub
```

**âš ï¸ é‡è¦æé†’**ï¼š
- **å¿…é ˆæŒ‰ç…§é †åºåŸ·è¡Œ**ï¼šæå–æ•¸æ“š â†’ è¨ˆç®—é »ç‡ â†’ å¯«å…¥åƒæ•¸ â†’ å¯«å…¥æ•¸æ“š â†’ å‰µå»ºåœ–è¡¨
- **é †åºéŒ¯èª¤åœ–è¡¨å¯èƒ½å‡ºä¸ä¾†**ï¼šç‰¹åˆ¥æ˜¯ã€Œå¯«å…¥æ•¸æ“šè¡¨ã€å¿…é ˆåœ¨ã€Œå‰µå»ºåœ–è¡¨ã€ä¹‹å‰

---

### æ­¥é©Ÿ 4.3.1ï¼šæå–è®€å€¼æ•¸æ“š

```vba
Function ExtractReadingData(ws As Worksheet, seqInfo As Object, colIndex As Long) As Collection
    Dim readingData As New Collection

    ' å¾ S/N è¡Œçš„ä¸‹ä¸€è¡Œé–‹å§‹æå–æ•¸æ“š
    For row = snRow + 1 To seqInfo("endRow")
        cellValue = ws.Cells(row, colIndex).Value

        ' æ’é™¤ç©ºå€¼ã€Maximumã€Minimum
        If cellValue <> "" And _
           UCase(cellValue) <> "MAXIMUM" And _
           UCase(cellValue) <> "MINIMUM" And _
           IsNumeric(cellValue) Then

            readingData.Add CDbl(cellValue)
        End If
    Next row

    Set ExtractReadingData = readingData
End Function
```

**è¼¸å‡ºç¯„ä¾‹**ï¼ˆVdcRead1ï¼‰ï¼š
```
readingData = {5.28, 5.29, 5.30, 5.28, 5.31, 5.29, 5.30, 5.28, ...}
```

---

### æ­¥é©Ÿ 4.3.2ï¼šè¨ˆç®—é »ç‡ + åŠ å…¥ Spec æ¨™è¨˜ï¼ˆæœ€é‡è¦ï¼‰

```vba
Function CalculateFrequencyWithSpec(values As Collection, params As Object, readingName As String) As Collection
    ' ===== æ­¥é©Ÿ 1ï¼šè¨ˆç®—é »ç‡ =====
    Dim freqDict As Object
    Set freqDict = CreateObject("Scripting.Dictionary")

    For Each val In values
        roundedVal = RoundByValueRange(CDbl(val))  ' æ™ºèƒ½å››æ¨äº”å…¥

        If freqDict.Exists(roundedVal) Then
            freqDict(roundedVal) = freqDict(roundedVal) + 1
        Else
            freqDict.Add roundedVal, 1
        End If
    Next val

    ' ===== æ­¥é©Ÿ 2ï¼šæå–åŸºç¤åç¨±ï¼ŒæŸ¥æ‰¾å°æ‡‰çš„ Spec =====
    Dim baseName As String
    baseName = ExtractBaseName(readingName)  ' "5.3_VdcRead1" â†’ "Vdc"

    Dim specMax As Variant, specMin As Variant
    specMax = FindSpecValue(params, baseName, "Max")  ' æŸ¥æ‰¾ "VdcMax"
    specMin = FindSpecValue(params, baseName, "Min")  ' æŸ¥æ‰¾ "VdcMin"

    ' ===== æ­¥é©Ÿ 3ï¼šå»ºç«‹å®Œæ•´æ•¸æ“šé›†åˆï¼ˆæ•¸å€¼ + Spec æ¨™è¨˜ï¼‰=====
    Dim allData As Object
    Set allData = CreateObject("Scripting.Dictionary")

    ' 3.1 åŠ å…¥æ‰€æœ‰é »ç‡æ•¸æ“š
    For Each key In freqDict.Keys
        allData.Add key, Array(key, freqDict(key), "", RGB(0, 0, 0))
    Next key

    ' 3.2 åŠ å…¥ Spec Max æ¨™è¨˜ï¼ˆå¦‚æœå­˜åœ¨ä¸”æœªé‡è¤‡ï¼‰
    If Not IsEmpty(specMax) Then
        Dim maxKey As String
        maxKey = CStr(specMax) & "_MAX"  ' "5.5_MAX"

        If Not allData.Exists(maxKey) Then
            allData.Add maxKey, Array(maxKey, Empty, "max", RGB(255, 0, 0))  ' ç´…è‰²ï¼Œé »ç‡ç‚ºç©º
        End If
    End If

    ' 3.3 åŠ å…¥ Spec Min æ¨™è¨˜ï¼ˆå¦‚æœå­˜åœ¨ä¸”æœªé‡è¤‡ï¼‰
    If Not IsEmpty(specMin) Then
        Dim minKey As String
        minKey = CStr(specMin) & "_Min"  ' "5.2_Min"

        If Not allData.Exists(minKey) Then
            allData.Add minKey, Array(minKey, Empty, "min", RGB(0, 176, 80))  ' ç¶ è‰²ï¼Œé »ç‡ç‚ºç©º
        End If
    End If

    ' ===== æ­¥é©Ÿ 4ï¼šå¾å°åˆ°å¤§æ’åºï¼ˆåŒ…å« Spec æ¨™è¨˜ï¼‰=====
    ' ä½¿ç”¨ Bubble Sort æ’åº
    ' æ’åºè¦å‰‡ï¼š
    ' - æå–æ•¸å­—éƒ¨åˆ†ï¼ˆå»é™¤ "_MAX", "_Min" å¾Œç¶´ï¼‰
    ' - æŒ‰æ•¸å­—å¤§å°æ’åº
    ' - ç›¸åŒæ•¸å­—æ™‚ï¼Œæ•¸å€¼åœ¨å‰ï¼ŒSpec æ¨™è¨˜åœ¨å¾Œ

    ' ... bubble sort implementation ...

    ' ===== æ­¥é©Ÿ 5ï¼šè¿”å›æ’åºå¾Œçš„é›†åˆ =====
    Set CalculateFrequencyWithSpec = sortedCollection
End Function
```

**è¼¸å‡ºç¯„ä¾‹**ï¼ˆå·²æ’åºï¼‰ï¼š
```
[0] = ("4.55", 1, "", RGB(0,0,0))           â† å°æ•¸å€¼
[1] = ("4.63", 1, "", RGB(0,0,0))
[2] = ("4.84", 1, "", RGB(0,0,0))
[3] = ("5.2_Min", Empty, "min", RGB(0,176,80))  â† Spec Min æ¨™è¨˜ï¼ˆç¶ è‰²ï¼Œé »ç‡ç©ºç™½ï¼‰
[4] = ("5.28", 3, "", RGB(0,0,0))           â† ä¸€èˆ¬æ•¸å€¼ï¼ˆé »ç‡ 3ï¼‰
[5] = ("5.29", 5, "", RGB(0,0,0))           â† ä¸€èˆ¬æ•¸å€¼ï¼ˆé »ç‡ 5ï¼‰
[6] = ("5.30", 2, "", RGB(0,0,0))
[7] = ("5.5_MAX", Empty, "max", RGB(255,0,0))  â† Spec Max æ¨™è¨˜ï¼ˆç´…è‰²ï¼Œé »ç‡ç©ºç™½ï¼‰
```

**é—œéµèªªæ˜**ï¼š
- âœ… **èˆ‡è®€å€¼ç›¸é—œçš„ Spec æ‰åŠ å…¥**ï¼š`VdcRead1` â†’ æŸ¥æ‰¾ `VdcMax`, `VdcMin`
- âœ… **Spec æ¨™è¨˜é »ç‡ç‚ºç©º**ï¼š`Empty`ï¼Œåœ–è¡¨ä¸­æŸ±é«˜ç‚º 0
- âœ… **å¾å°åˆ°å¤§æ’åº**ï¼šåŒ…å« Spec æ¨™è¨˜ä¸€èµ·æ’åº
- âœ… **é¡è‰²æ¨™ç¤º**ï¼šMax ç´…è‰²ã€Min ç¶ è‰²

---

### æ­¥é©Ÿ 4.3.3ï¼šå¯«å…¥åƒæ•¸è¡¨ï¼ˆ2 æ¬„ï¼‰

```vba
Sub WriteParameterTable(ws As Worksheet, params As Object, readingName As String, startRow As Long, startCol As Long)
    ' ===== è¡¨é ­ =====
    ws.Cells(startRow, startCol).Value = "Condition"
    ws.Cells(startRow, startCol + 1).Value = "Value"

    ' æ©˜è‰²åº•è‰²
    ws.Range(ws.Cells(startRow, startCol), ws.Cells(startRow, startCol + 1)).Interior.Color = RGB(255, 224, 178)
    ws.Range(ws.Cells(startRow, startCol), ws.Cells(startRow, startCol + 1)).Font.Bold = True

    ' ===== å¯«å…¥åƒæ•¸ =====
    currentRow = startRow + 1

    For Each paramName In params.Keys
        ws.Cells(currentRow, startCol).Value = paramName       ' Condition
        ws.Cells(currentRow, startCol + 1).Value = params(paramName)  ' Value

        ' é¡è‰²æ¨™ç¤ºï¼šMax ç´…è‰²ã€Min ç¶ è‰²
        If InStr(UCase(paramName), "MAX") > 0 Then
            ws.Cells(currentRow, startCol).Font.Color = RGB(255, 0, 0)
            ws.Cells(currentRow, startCol).Font.Bold = True
            ws.Cells(currentRow, startCol + 1).Font.Color = RGB(255, 0, 0)
            ws.Cells(currentRow, startCol + 1).Font.Bold = True
        ElseIf InStr(UCase(paramName), "MIN") > 0 Then
            ws.Cells(currentRow, startCol).Font.Color = RGB(0, 176, 80)
            ws.Cells(currentRow, startCol).Font.Bold = True
            ws.Cells(currentRow, startCol + 1).Font.Color = RGB(0, 176, 80)
            ws.Cells(currentRow, startCol + 1).Font.Bold = True
        End If

        ' æ·ºé»ƒè‰²èƒŒæ™¯
        ws.Cells(currentRow, startCol).Interior.Color = RGB(255, 249, 196)
        ws.Cells(currentRow, startCol + 1).Interior.Color = RGB(255, 249, 196)

        currentRow = currentRow + 1
    Next paramName
End Sub
```

**è¼¸å‡ºç¯„ä¾‹**ï¼ˆA-B æ¬„ï¼‰ï¼š
```
| Condition  | Value |
|------------|-------|
| Vin        | 24    |
| Fin        | 0     |
| VdcMax     | 5.5   | â† ç´…è‰²ç²—é«”
| VdcMin     | 5.2   | â† ç¶ è‰²ç²—é«”
| VppMax     | 0.05  |
```

---

### æ­¥é©Ÿ 4.3.4ï¼šå¯«å…¥æ•¸æ“šè¡¨ï¼ˆ2 æ¬„ï¼‰

```vba
Sub WriteDataTable(ws As Worksheet, freqData As Collection, readingName As String, startRow As Long, startCol As Long)
    ' ===== è¡¨é ­ =====
    ws.Cells(startRow, startCol).Value = readingName  ' "VdcRead1"
    ws.Cells(startRow, startCol + 1).Value = "Frequency"

    ' è—è‰²åº•è‰² + ç™½è‰²å­—
    ws.Range(ws.Cells(startRow, startCol), ws.Cells(startRow, startCol + 1)).Interior.Color = RGB(68, 114, 196)
    ws.Range(ws.Cells(startRow, startCol), ws.Cells(startRow, startCol + 1)).Font.Color = RGB(255, 255, 255)
    ws.Range(ws.Cells(startRow, startCol), ws.Cells(startRow, startCol + 1)).Font.Bold = True

    ' ===== å¯«å…¥æ•¸æ“šï¼ˆå« Spec æ¨™è¨˜ï¼‰=====
    currentRow = startRow + 1

    For Each dataItem In freqData
        valLabel = dataItem(0)   ' "5.28" æˆ– "5.5_MAX"
        freq = dataItem(1)       ' 3 æˆ– Empty
        specType = dataItem(2)   ' "" æˆ– "max" æˆ– "min"
        fontColor = dataItem(3)  ' RGB é¡è‰²

        ' å¯«å…¥æ•¸å€¼æ¨™ç±¤
        ws.Cells(currentRow, startCol).Value = valLabel
        ws.Cells(currentRow, startCol).Font.Color = fontColor

        ' å¯«å…¥é »ç‡ï¼ˆSpec ä½ç½®ç‚ºç©ºï¼‰
        If Not IsEmpty(freq) Then
            ws.Cells(currentRow, startCol + 1).Value = freq
        End If

        ' Spec æ¨™è¨˜åŠ ç²—
        If specType <> "" Then
            ws.Cells(currentRow, startCol).Font.Bold = True
        End If

        currentRow = currentRow + 1
    Next dataItem
End Sub
```

**è¼¸å‡ºç¯„ä¾‹**ï¼ˆC-D æ¬„ï¼‰ï¼š
```
| VdcRead1   | Frequency |
|------------|-----------|
| 4.55       | 1         |
| 4.63       | 1         |
| 5.2_Min    |           | â† ç¶ è‰²ç²—é«”ï¼Œé »ç‡ç©ºç™½
| 5.28       | 3         |
| 5.29       | 5         |
| 5.5_MAX    |           | â† ç´…è‰²ç²—é«”ï¼Œé »ç‡ç©ºç™½
```

---

### æ­¥é©Ÿ 4.3.5ï¼šå‰µå»ºåœ–è¡¨

```vba
Sub CreateDistributionChart(ws As Worksheet, freqData As Collection, readingName As String, startRow As Long, startCol As Long)
    ' ===== æ­¥é©Ÿ 1ï¼šç¢ºå®šæ•¸æ“šç¯„åœï¼ˆå¿…é ˆå…ˆæœ‰æ•¸æ“šè¡¨ï¼‰=====
    Dim dataStartRow As Long, dataEndRow As Long
    dataStartRow = startRow + 1  ' è¡¨é ­çš„ä¸‹ä¸€è¡Œ
    dataEndRow = startRow + freqData.Count

    ' X è»¸æ•¸æ“šç¯„åœï¼ˆæ•¸å€¼æ¨™ç±¤ï¼Œå« Spec æ¨™è¨˜ï¼‰
    Dim xRange As Range
    Set xRange = ws.Range(ws.Cells(dataStartRow, startCol - 2), ws.Cells(dataEndRow, startCol - 2))

    ' Y è»¸æ•¸æ“šç¯„åœï¼ˆé »ç‡ï¼ŒSpec ä½ç½®ç‚ºç©ºï¼‰
    Dim yRange As Range
    Set yRange = ws.Range(ws.Cells(dataStartRow, startCol - 1), ws.Cells(dataEndRow, startCol - 1))

    ' ===== æ­¥é©Ÿ 2ï¼šç¢ºå®šåœ–è¡¨ä½ç½®ï¼ˆä½¿ç”¨å„²å­˜æ ¼éŒ¨é»ï¼‰=====
    Dim topLeftCell As Range
    Set topLeftCell = ws.Cells(startRow, startCol)

    ' ===== æ­¥é©Ÿ 3ï¼šå‰µå»ºåœ–è¡¨ç‰©ä»¶ =====
    Dim chartObj As ChartObject
    Set chartObj = ws.ChartObjects.Add( _
        Left:=topLeftCell.Left, _
        Top:=topLeftCell.Top, _
        Width:=450, _
        Height:=280)

    ' ===== æ­¥é©Ÿ 4ï¼šè¨­å®šåœ–è¡¨é¡å‹ç‚ºæŸ±ç‹€åœ– =====
    With chartObj.Chart
        .ChartType = xlColumnClustered

        ' ===== æ­¥é©Ÿ 5ï¼šè¨­å®šæ•¸æ“šæº =====
        .SetSourceData Source:=yRange

        ' ===== æ­¥é©Ÿ 6ï¼šè¨­å®š X è»¸é¡åˆ¥ï¼ˆæ•¸å€¼æ¨™ç±¤ï¼‰=====
        .SeriesCollection(1).XValues = xRange

        ' ===== æ­¥é©Ÿ 7ï¼šè¨­å®šæ¨™é¡Œ =====
        .HasTitle = True
        .ChartTitle.Text = readingName & " Distribution"

        ' ===== æ­¥é©Ÿ 8ï¼šè¨­å®š Y è»¸æ ¼å¼ï¼ˆæ•´æ•¸ï¼‰=====
        With .Axes(xlValue)
            .HasTitle = True
            .AxisTitle.Text = "Frequency"
            .MajorUnit = 1
            .NumberFormat = "0"  ' æ•´æ•¸æ ¼å¼
            .MinimumScale = 0
        End With

        ' ===== æ­¥é©Ÿ 9ï¼šè¨­å®šæŸ±ç‹€åœ–é¡è‰²ï¼ˆè—è‰²ï¼‰=====
        .SeriesCollection(1).Format.Fill.ForeColor.RGB = RGB(68, 114, 196)

        ' ===== æ­¥é©Ÿ 10ï¼šç§»é™¤åœ–ä¾‹ï¼ˆå¦‚ä¸éœ€è¦ï¼‰=====
        .HasLegend = False
    End With
End Sub
```

**è¼¸å‡ºç¯„ä¾‹**ï¼ˆE æ¬„å¾€å³ï¼‰ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VdcRead1 Distribution         â”‚
â”‚                               â”‚
â”‚  Frequency                    â”‚
â”‚    5 â”¤           â–ˆâ–ˆâ–ˆâ–ˆ          â”‚
â”‚    4 â”¤           â–ˆâ–ˆâ–ˆâ–ˆ          â”‚
â”‚    3 â”¤     â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ          â”‚
â”‚    2 â”¤     â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ          â”‚
â”‚    1 â”¤  â–ˆ  â–ˆ  â–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆ       â”‚
â”‚    0 â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´   â”‚
â”‚      4.55   5.2  5.28 5.29 5.5â”‚
â”‚             Min       MAX      â”‚
â”‚             (ç©º) (æœ‰æŸ±)(ç©º)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—œéµèªªæ˜**ï¼š
- âœ… **æ•¸æ“šè¡¨å¿…é ˆå…ˆå­˜åœ¨**ï¼šåœ–è¡¨å¾æ•¸æ“šè¡¨è®€å–ç¯„åœ
- âœ… **Spec ä½ç½®æŸ±é«˜ç‚º 0**ï¼šå› ç‚ºé »ç‡ç‚ºç©º
- âœ… **Y è»¸æ•´æ•¸æ ¼å¼**ï¼š`NumberFormat = "0"`
- âœ… **æŸ±ç‹€åœ–è—è‰²**ï¼š`RGB(68, 114, 196)`

---

### æ­¥é©Ÿ 5ï¼šç¹¼çºŒå…¶ä»–è®€å€¼åœ–è¡¨è£½ä½œï¼ˆåŒä¸€å€‹ SEQ å‚ç›´æ’åˆ—ï¼‰

```vba
' åœ¨æ­¥é©Ÿ 4.3 çš„è¿´åœˆä¸­ç¹¼çºŒè™•ç†
For Each readingInfo In readingsList
    ' VdcRead1 â†’ å‰µå»ºå®Œæˆ
    ' VppRead1 â†’ å¾€ä¸‹ç§»å‹•ï¼Œç¹¼çºŒå‰µå»º
    ' VdcRead2 â†’ å¾€ä¸‹ç§»å‹•ï¼Œç¹¼çºŒå‰µå»º
    ' ...

    Call CreateOneDistributionBlock(...)
    currentRow = currentRow + 20  ' ä¸‹ä¸€å€‹è®€å€¼å¾€ä¸‹ç§»å‹•
Next readingInfo
```

---

### æ­¥é©Ÿ 6ï¼šè™•ç†ä¸‹ä¸€å€‹ SEQï¼ˆæ°´å¹³æ–°å¢ï¼‰

```vba
' åœ¨æ­¥é©Ÿ 4 çš„è¿´åœˆä¸­ç¹¼çºŒè™•ç†
For Each seqInfo In seqList
    ' SEQ.2 â†’ è™•ç†å®Œæˆï¼ˆæ¬„ A-Zï¼‰
    ' SEQ.3 â†’ å¾€å³ç§»å‹•ï¼Œç¹¼çºŒè™•ç†ï¼ˆæ¬„ AB-BZï¼‰
    ' SEQ.4 â†’ å¾€å³ç§»å‹•ï¼Œç¹¼çºŒè™•ç†ï¼ˆæ¬„ CA-...ï¼‰

    currentCol = currentCol + 28 + 2  ' ä¸‹ä¸€å€‹ SEQ å¾€å³ç§»å‹•
Next seqInfo
```

---

## ğŸ“Š æœ€çµ‚è¼¸å‡ºå¸ƒå±€

```
Distribution Charts å·¥ä½œè¡¨ï¼š

æ¬„ä½ A-Z (SEQ.2)              æ¬„ä½ AB-BZ (SEQ.3)           æ¬„ä½ CA-... (SEQ.4)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SEQ.2: Load Reg    â”‚       â”‚ SEQ.3: Input/Out   â”‚       â”‚ SEQ.4: Turn On     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ (VdcRead1)         â”‚       â”‚ (Iinrms)           â”‚       â”‚ (Ton)              â”‚
â”‚ åƒæ•¸â”‚æ•¸æ“šâ”‚åœ–è¡¨     â”‚       â”‚ åƒæ•¸â”‚æ•¸æ“šâ”‚åœ–è¡¨     â”‚       â”‚ åƒæ•¸â”‚æ•¸æ“šâ”‚åœ–è¡¨     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ (VppRead1)         â”‚       â”‚ (Pin)              â”‚
â”‚ åƒæ•¸â”‚æ•¸æ“šâ”‚åœ–è¡¨     â”‚       â”‚ åƒæ•¸â”‚æ•¸æ“šâ”‚åœ–è¡¨     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ (VdcRead2)         â”‚       â”‚ (Eff)              â”‚
â”‚ åƒæ•¸â”‚æ•¸æ“šâ”‚åœ–è¡¨     â”‚       â”‚ åƒæ•¸â”‚æ•¸æ“šâ”‚åœ–è¡¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ é‡è¦æé†’

### åŸ·è¡Œé †åºï¼ˆåœ–è¡¨å¯èƒ½å‡ºä¸ä¾†çš„å¸¸è¦‹åŸå› ï¼‰

**æ­£ç¢ºé †åº**ï¼š
1. âœ… æå–è®€å€¼æ•¸æ“š
2. âœ… è¨ˆç®—é »ç‡ + åŠ å…¥ Spec æ¨™è¨˜
3. âœ… **å¯«å…¥åƒæ•¸è¡¨ï¼ˆå¿…é ˆå…ˆå¯«å…¥ï¼‰**
4. âœ… **å¯«å…¥æ•¸æ“šè¡¨ï¼ˆå¿…é ˆå…ˆå¯«å…¥ï¼‰**
5. âœ… **å‰µå»ºåœ–è¡¨ï¼ˆæœ€å¾ŒåŸ·è¡Œï¼‰**

**éŒ¯èª¤é †åºï¼ˆæœƒå°è‡´åœ–è¡¨å‡ºä¸ä¾†ï¼‰**ï¼š
- âŒ å…ˆå‰µå»ºåœ–è¡¨ï¼Œå¾Œå¯«å…¥æ•¸æ“š â†’ **æ•¸æ“šæºä¸å­˜åœ¨**
- âŒ æœªå¯«å…¥æ•¸æ“šè¡¨ï¼Œç›´æ¥å‰µå»ºåœ–è¡¨ â†’ **ç¯„åœç‚ºç©º**
- âŒ è·³éé »ç‡è¨ˆç®—ï¼Œç›´æ¥å¯«å…¥ â†’ **æ²’æœ‰ Spec æ¨™è¨˜**

### Spec åŒ¹é…è¦å‰‡

**å¿…é ˆç›¸é—œæ‰åŠ å…¥**ï¼š
- `VdcRead1` â†’ æŸ¥æ‰¾ `VdcMax`, `VdcMin` âœ…
- `VppRead1` â†’ æŸ¥æ‰¾ `VppMax`, `VppMin` âœ…
- `Eff` â†’ æŸ¥æ‰¾ `EffMin` âœ…ï¼ˆæ•ˆç‡åªæœ‰ Minï¼‰
- `Pin` â†’ æŸ¥æ‰¾ `PinMax` âœ…ï¼ˆåŠŸç‡åªæœ‰ Maxï¼‰
- `VdcRead1` â†’ **ä¸æœƒ** æŸ¥æ‰¾ `VppMax` âŒ

### é¡è‰²è¦ç¯„

| å…ƒç´  | é¡è‰² | RGB | ç”¨é€” |
|------|------|-----|------|
| Spec Max | ç´…è‰² | `RGB(255, 0, 0)` | åƒæ•¸è¡¨ + æ•¸æ“šè¡¨ |
| Spec Min | ç¶ è‰² | `RGB(0, 176, 80)` | åƒæ•¸è¡¨ + æ•¸æ“šè¡¨ |
| åƒæ•¸è¡¨è¡¨é ­ | æ©˜è‰² | `RGB(255, 224, 178)` | èƒŒæ™¯ |
| æ•¸æ“šè¡¨è¡¨é ­ | è—è‰² | `RGB(68, 114, 196)` | èƒŒæ™¯ + ç™½å­— |
| åƒæ•¸å€¼å€åŸŸ | æ·ºé»ƒè‰² | `RGB(255, 249, 196)` | èƒŒæ™¯ |
| æŸ±ç‹€åœ– | è—è‰² | `RGB(68, 114, 196)` | åœ–è¡¨ |

---

## ğŸ“ é—œéµå‡½æ•¸åˆ—è¡¨

| å‡½æ•¸åç¨± | åŠŸèƒ½ | è¼¸å…¥ | è¼¸å‡º |
|---------|------|------|------|
| `ScanAllSEQFromSheet` | æƒææ‰€æœ‰ SEQ å€åŸŸ | Worksheet | Collection of SEQ info |
| `ExtractSEQParameters` | æå– SEQ åƒæ•¸ | Worksheet, SEQ info | Dictionary (params) |
| `IdentifyReadingColumns` | è­˜åˆ¥è®€å€¼æ¬„ä½ | Worksheet, SEQ info | Collection of reading info |
| `ExtractReadingData` | æå–è®€å€¼æ•¸æ“š | Worksheet, SEQ info, column index | Collection of values |
| `ExtractBaseName` | æå–åŸºç¤åç¨± | Reading name | Base name (ä¾‹å¦‚ï¼šVdc) |
| `FindSpecValue` | æŸ¥æ‰¾ Spec å€¼ | Params, base name, type | Spec value or Empty |
| `RoundByValueRange` | æ™ºèƒ½å››æ¨äº”å…¥ | Value | Rounded value |
| `CalculateFrequencyWithSpec` | è¨ˆç®—é »ç‡ + Spec | Values, params, name | Collection (sorted with Spec) |
| `WriteParameterTable` | å¯«å…¥åƒæ•¸è¡¨ | Worksheet, params, ... | (å¯«å…¥ Excel) |
| `WriteDataTable` | å¯«å…¥æ•¸æ“šè¡¨ | Worksheet, freqData, ... | (å¯«å…¥ Excel) |
| `CreateDistributionChart` | å‰µå»ºåœ–è¡¨ | Worksheet, freqData, ... | (å‰µå»ºåœ–è¡¨) |

---

**æœ€å¾Œæ›´æ–°**ï¼š2025-12-08
**ç‰ˆæœ¬**ï¼šv2.0 å®Œæ•´æµç¨‹æ‘˜è¦
**ç‹€æ…‹**ï¼šâœ… å·²ç¢ºèªé †åºæ­£ç¢ºï¼Œå¯ç›´æ¥ä½¿ç”¨
