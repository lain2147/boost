# 圖表創建錯誤修復指南

## 問題描述
執行分布圖功能時出現大量「圖表創建錯誤：程序呼叫或引數不正確」錯誤。

## 解決方案

文件 `分布圖功能_修正版_可執行.txt` 已經修正完成。

### 方法：直接替換整個 VBA 模組（最簡單）

#### 步驟 1：備份現有代碼
1. 開啟 `EXCEL_TO_TXT.xlsm`
2. 按 `Alt + F11` 開啟 VBA 編輯器
3. 找到包含分布圖代碼的模組
4. 按 `Ctrl + A` 全選，按 `Ctrl + C` 複製（備份）
5. 將備份貼到一個文字檔案中保存

#### 步驟 2：刪除舊代碼
1. 在 VBA 編輯器中，按 `Ctrl + A` 全選所有代碼
2. 按 `Delete` 刪除

#### 步驟 3：貼上新代碼
1. 開啟 `分布圖功能_修正版_可執行.txt`
2. 按 `Ctrl + A` 全選，按 `Ctrl + C` 複製
3. 回到 VBA 編輯器
4. 按 `Ctrl + V` 貼上

#### 步驟 4：儲存並測試
1. 按 `Ctrl + S` 儲存
2. 按 `Alt + Q` 關閉 VBA 編輯器
3. 執行分布圖功能
4. 檢查是否還有錯誤訊息

## 修改內容說明

### 主要修改位置

#### 位置 1：CreateSingleDistributionChart_H 函數（第 5298-5302 行）
```vba
' 修改前（錯誤）
chartLeft = ws.Cells(1, blockCol + 2).Left
chartTop = ws.Rows(blockRow).Top
Set chartObj = ws.ChartObjects.Add(Left:=chartLeft, Top:=chartTop, Width:=450, Height:=280)

' 修改後（正確）
Set chartObj = ws.ChartObjects.Add( _
    Left:=ws.Cells(blockRow, blockCol + 2).Left, _
    Top:=ws.Cells(blockRow, blockCol + 2).Top, _
    Width:=450, _
    Height:=280)
```

#### 位置 2：CreateSingleDistributionChart_Final 函數（第 5144-5148 行）
```vba
' 修改前（錯誤）
Set chartObj = ws.ChartObjects.Add(Left:=ws.Columns(8).Left, Top:=ws.Rows(blockRow).Top, Width:=450, Height:=280)

' 修改後（正確）
Set chartObj = ws.ChartObjects.Add( _
    Left:=ws.Cells(blockRow, 8).Left, _
    Top:=ws.Cells(blockRow, 8).Top, _
    Width:=450, _
    Height:=280)
```

#### 位置 3：ConfigureDistributionChart 函數（第 5607-5608 行）
```vba
' 修改前（錯誤）
Loop
Dim s As Series
Set s = ch.SeriesCollection.NewSeries
...
ch.ChartType = xlColumnClustered    ' ← 錯誤位置
s.AxisGroup = 1

' 修改後（正確）
Loop
' 設置圖表類型（必須在添加 Series 之前）
ch.ChartType = xlColumnClustered    ' ← 正確位置
Dim s As Series
Set s = ch.SeriesCollection.NewSeries
...
s.AxisGroup = 1
```

## 問題根源

1. **ChartObjects.Add 參數錯誤**：使用錯誤的方式計算圖表位置
2. **Chart.ChartType 設置順序錯誤**：在添加 Series 之後才設置圖表類型

## 預期結果

修正後：
- ✅ 無圖表創建錯誤
- ✅ 所有分布圖正常顯示
- ✅ 每個測試類型都有對應的圖表
- ✅ 圖表包含柱狀圖、折線和 Spec 線

## 如果還有問題

如果按照步驟操作後還是出現錯誤，請檢查：

1. **是否完整複製貼上**：確保所有代碼都已替換
2. **Excel 版本**：建議使用 Excel 2016 或更新版本
3. **VBA 模組數量**：確保只有一個包含這些函數的模組
4. **工作表名稱**：確保有「分佈圖」工作表

## 聯絡支援

如果問題持續，請提供：
- 錯誤訊息截圖
- Excel 版本
- 測試資料範例
